//animations
function BattleView() {}

BattleView.prototype = {
  updateView: function( data ) {
    this.updateHealthBar( data );

    // Attack animations have a naming convention
    // For an attack called 'foobar'
    // The method will be 'foobarAnimate'
    // convention over configuration
    var attackMethod = this[data.attackType + 'Animate'];
    attackMethod( data.targetIsSelf );
  },
  myPokemonFaints: function(){
    var $mypokemon = $('.my-pokemon img');
    $mypokemon.toggleClass('animated fadeOutDown');
  },
  theirPokemonFaints: function(){
    var $theirpokemon = $('.their-pokemon img');
    $theirpokemon.toggleClass('animated rollOut');
  },
  updateHealthBar: function(data){
    var updateTarget = data.targetIsSelf ? ".my-healthbar" : ".their-healthbar";
    $( updateTarget ).val( data.health / data.maxHealth * 100 );
  },
  tackleAnimate: function( targetIsSelf ){
    if (targetIsSelf) {
      var $attackingPokemon = $('.their-pokemon');
      var $targetPokemon = $( '.my-pokemon' );
      var direction = 'Right';
    } else {
      var $attackingPokemon = $('.my-pokemon');
      var $targetPokemon = $( '.their-pokemon' );
      var direction = 'Left';
    }

    var animateClass = 'animated rubberBand';
    var $tackleSound = $('.sound-effects')

    $attackingPokemon.addClass( animateClass );
    $tackleSound.html('<%= audio_tag('tackle.wav', autoplay: true) %>');

    $attackingPokemon.one('webkitAnimationEnd mozAnimationEnd', function() {
      $( this ).removeClass( animateClass );
      $( this ).off( 'animationend' );
      $tackleSound.off('animationend');
    });

    $targetPokemon.addClass( 'animated flash' );
    $targetPokemon.one('webkitAnimationEnd mozAnimationEnd', function() {
      $( this ).removeClass( 'animated flash' );
      $( this ).off( 'animationend' );
    });
  },

  counterAnimate: function( targetIsSelf ){
    if (targetIsSelf) {
        var $attackingPokemon = $('.their-pokemon');
        var $targetPokemon = $( '.my-pokemon' );
        var direction = 'Right';
      } else {
        var $attackingPokemon = $('.my-pokemon');
        var $targetPokemon = $( '.their-pokemon' );
        var direction = 'Left';
      }

      var animateClass = 'animated wobble';
      var $tackleSound = $('.sound-effects')

      $attackingPokemon.addClass( animateClass );
      $tackleSound.html('<%= audio_tag('counter.wav', autoplay: true) %>');

      $attackingPokemon.one('webkitAnimationEnd mozAnimationEnd', function() {
        $( this ).removeClass( animateClass );
        $( this ).off( 'animationend' );
        $tackleSound.off('animationend');
      });

      $targetPokemon.addClass( 'animated flash' );
      $targetPokemon.one('webkitAnimationEnd mozAnimationEnd', function() {
        $( this ).removeClass( 'animated flash' );
        $( this ).off( 'animationend' );
    });
  }
};
